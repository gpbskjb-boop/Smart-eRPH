<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>eRPH Prasekolah - Desa Bakti</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        @media print {
            .no-print { display: none !important; }
            body { padding: 0; margin: 0; background: white; }
            .print-container { border: none !important; padding: 20px !important; width: 100% !important; max-width: none !important; }
        }
    </style>
</head>
<body class="bg-slate-50">
    <div id="root"></div>

    <script type="text/babel">
        // Data & Config (Kekal Asal)
        const MINGGU_LIST = Array.from({ length: 45 }, (_, i) => `Minggu ${i + 1}`);
        const HARI_LIST = ["Isnin", "Selasa", "Rabu", "Khamis", "Jumaat"];
        const JAWATAN_ADMIN = ["Guru Besar", "PK Pentadbiran", "PK HEM", "PK Kokurikulum", "Penyelaras"];
        const TUNJANG_LIST = [
            "Sosioemosi",
            "Fizikal dan Kesejahteraan Diri",
            "Kerohanian, Nilai dan Kewarganegaraan",
            "Bahasa dan Literasi",
            "Kognitif",
            "Kreativiti dan Estetika"
        ];
        const STRATEGI_LIST = ["ABM", "BBM", "ICT", "KBAT"];

        // Helper for Lucide Icons
        const Icon = ({ name, size = 20, className = "" }) => {
            const iconRef = React.useRef(null);
            React.useEffect(() => {
                if (iconRef.current) {
                    lucide.createIcons({
                        attrs: { size, class: className },
                        nameAttr: 'data-lucide'
                    });
                }
            }, [name, size, className]);
            return <i data-lucide={name} ref={iconRef}></i>;
        };

        function App() {
            // State Management dari kod asal
            const [isLoggedIn, setIsLoggedIn] = React.useState(false);
            const [viewMode, setViewMode] = React.useState('guru');
            const [currentUserData, setCurrentUserData] = React.useState(null);
            const [activeTab, setActiveTab] = React.useState('records');
            const [records, setRecords] = React.useState([]);
            const [schoolName, setSchoolName] = React.useState("SK DESA BAKTI");
            const [loginInput, setLoginInput] = React.useState({ name: '', password: '', kodSekolah: '' });
            const [formData, setFormData] = React.useState({
                nama: "", kelas: "", mataPelajaran: "", minggu: MINGGU_LIST[0],
                hari: HARI_LIST[0], tarikh: new Date().toISOString().split('T')[0],
                masaMula: "", masaTamat: "", tajuk: "", tunjang: "",
                sp: "", objektif: "", aktiviti: "", refleksi: "",
                pentaksiran: "Ditaksir", strategi: []
            });

            const handleLogin = (e) => {
                e.preventDefault();
                const kod = loginInput.kodSekolah.trim().toUpperCase();
                if (viewMode === 'admin' && loginInput.password === "admin123") {
                    setCurrentUserData({ name: loginInput.name, role: 'admin', kodSekolah: kod });
                    setIsLoggedIn(true);
                } else if (viewMode === 'guru') {
                    setCurrentUserData({ nama: loginInput.name, role: 'guru', ic: loginInput.password, kodSekolah: kod });
                    setFormData(p => ({ ...p, nama: loginInput.name }));
                    setIsLoggedIn(true);
                } else { alert("Maklumat salah!"); }
            };

            if (!isLoggedIn) {
                return (
                    <div className="min-h-screen bg-slate-100 flex items-center justify-center p-4 flex-col">
                        <div className="bg-white w-full max-w-sm rounded-3xl shadow-xl overflow-hidden">
                            <div className="bg-indigo-700 p-8 text-white text-center">
                                <h1 className="text-xl font-bold uppercase tracking-widest">eRPH PRASEKOLAH</h1>
                                <p className="text-xs opacity-70">Log Masuk</p>
                            </div>
                            <div className="p-6 space-y-4">
                                <div className="flex bg-slate-100 p-1 rounded-xl">
                                    <button onClick={() => setViewMode('guru')} className={`flex-1 py-2 rounded-lg text-xs font-bold ${viewMode === 'guru' ? 'bg-white shadow' : ''}`}>GURU</button>
                                    <button onClick={() => setViewMode('admin')} className={`flex-1 py-2 rounded-lg text-xs font-bold ${viewMode === 'admin' ? 'bg-white shadow' : ''}`}>ADMIN</button>
                                </div>
                                <form onSubmit={handleLogin} className="space-y-4">
                                    <input type="text" value={loginInput.kodSekolah} onChange={e => setLoginInput({...loginInput, kodSekolah: e.target.value})} placeholder="Kod Sekolah" className="w-full p-3 border-2 rounded-xl uppercase font-bold text-indigo-700" required />
                                    <input type="text" value={loginInput.name} onChange={e => setLoginInput({...loginInput, name: e.target.value})} placeholder="Nama Penuh" className="w-full p-3 border-2 rounded-xl" required />
                                    <input type="password" value={loginInput.password} onChange={e => setLoginInput({...loginInput, password: e.target.value})} placeholder={viewMode === 'admin' ? "Password" : "No IC"} className="w-full p-3 border-2 rounded-xl" required />
                                    <button className="w-full bg-indigo-600 text-white p-3 rounded-xl font-bold uppercase">Masuk</button>
                                </form>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-slate-50 pb-20">
                    <nav className="bg-indigo-700 text-white p-4 sticky top-0 z-50 flex justify-between items-center shadow-lg">
                        <div className="flex items-center gap-2">
                            <div className="bg-white/20 p-2 rounded-lg"><Icon name="user" /></div>
                            <div className="text-xs uppercase font-bold">
                                {currentUserData.nama || currentUserData.name} <br/>
                                <span className="text-[10px] opacity-60">{currentUserData.role} â€¢ {currentUserData.kodSekolah}</span>
                            </div>
                        </div>
                        <div className="flex gap-2">
                            <button onClick={() => setActiveTab('records')} className={`p-2 rounded-lg ${activeTab === 'records' ? 'bg-white text-indigo-700' : ''}`}><Icon name="folder" /></button>
                            <button onClick={() => setActiveTab('settings')} className={`p-2 rounded-lg ${activeTab === 'settings' ? 'bg-white text-indigo-700' : ''}`}><Icon name="settings" /></button>
                            <button onClick={() => setIsLoggedIn(false)} className="bg-rose-500 p-2 rounded-lg text-white"><Icon name="log-out" /></button>
                        </div>
                    </nav>

                    <div className="p-4 max-w-5xl mx-auto space-y-6">
                        {activeTab === 'records' && currentUserData.role === 'guru' && (
                            <div className="bg-white p-6 rounded-3xl shadow-sm border border-indigo-100">
                                <h2 className="font-bold mb-4 flex items-center gap-2 text-indigo-700 uppercase">
                                    <Icon name="plus" size={18}/> Tambah RPH Baru
                                </h2>
                                <form className="space-y-4">
                                    <div className="grid grid-cols-1 md:grid-cols-4 gap-3">
                                        <select className="p-3 border rounded-xl text-sm font-bold bg-slate-50">
                                            {MINGGU_LIST.map(m => <option key={m}>{m}</option>)}
                                        </select>
                                        <select className="p-3 border rounded-xl text-sm font-bold bg-slate-50">
                                            {HARI_LIST.map(h => <option key={h}>{h}</option>)}
                                        </select>
                                        <input type="date" className="p-3 border rounded-xl text-sm font-bold bg-slate-50" />
                                        <select className="p-3 border rounded-xl text-sm font-bold bg-slate-50">
                                            <option>Pilih Kelas</option>
                                        </select>
                                    </div>
                                    <div className="space-y-1">
                                        <label className="text-[10px] font-bold uppercase text-slate-400 ml-1">Tajuk RPH</label>
                                        <input type="text" placeholder="Masukkan Tajuk..." className="w-full p-3 border rounded-xl text-sm font-bold" />
                                    </div>
                                    <div className="space-y-1">
                                        <label className="text-[10px] font-bold uppercase text-slate-400 ml-1">Objektif</label>
                                        <textarea placeholder="Taip objektif..." className="w-full p-3 border rounded-xl text-sm font-bold h-24" />
                                    </div>
                                    <div className="space-y-1">
                                        <label className="text-[10px] font-bold uppercase text-slate-400 ml-1">Aktiviti</label>
                                        <textarea placeholder="Taip aktiviti..." className="w-full p-3 border rounded-xl text-sm font-bold h-24" />
                                    </div>
                                    <button type="button" className="w-full bg-indigo-600 text-white p-4 rounded-xl font-bold uppercase shadow-lg hover:bg-indigo-700 transition-all">Simpan Rekod</button>
                                </form>
                            </div>
                        )}
                        
                        <div className="space-y-4">
                            <h3 className="text-xs font-bold uppercase text-slate-400 px-1">Senarai Rekod</h3>
                            <div className="bg-white p-10 rounded-2xl border border-dashed border-slate-300 text-center text-slate-400 text-[10px] font-bold uppercase tracking-widest">
                                Tiada rekod dijumpai
                            </div>
                        </div>
                    </div>

                    <footer className="text-center py-6 opacity-30 text-[8px] font-bold uppercase tracking-[0.5em]">
                        Powered By GB Akbar & Tn. Hj. Hazidan @2026
                    </footer>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
